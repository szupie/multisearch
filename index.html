<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Multisearch</title>

		<style>
			* {
				box-sizing: border-box;
			}
			body {
				margin: 0;
				display: flex;
				flex-direction: column;
				height: 100vh;
			}
			form {
				flex: 0 0;
				padding: 4px;
				display: flex;
				align-items: center;
				justify-content: space-between;
				flex-wrap: wrap;
			}
			form input[type="text"], form button {
				height: 2em;
			}
			#query {
				margin-right: 1em;
			}
			#search-engines {
				order: 2;
			}
			#search-engines label {
				font-size: 12px;
				font-family: sans-serif;
				display: inline-block;
				margin-right: 4px;
				color: #666;
			}
			#search-engines input {
				color: #555;
				width: 20em;
			}
			#add {
				margin-left: -4px;
				width: 2em;
				background: none;
				border: none;

				/* replace text with icon */
				text-indent: 150%;
				white-space: nowrap;
				overflow: hidden;
				position: relative;
			}
			#add:focus, #add:hover {
				border: 1px solid #888;
			}
			#add::after {
				display: block;
				content: '+';
				position: absolute;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
				text-indent: 0;
				font-size: 1.5em;
				font-weight: bold;
				line-height: 1em;
				color: #444;
			}
			#results {
				flex: 1 1 auto;
				display: flex;
				flex-wrap: wrap;
			}
			#results iframe {
				flex: 1 0 auto;
				border: 1px solid #000;
				border-bottom: none;
			}
			#results iframe:not(:last-child) {
				border-right: none;
			}
		</style>
	</head>
	 
	<body>
		<form>
			<div id="search-engines">
				<label>URL <span class="count">1</span>
					<input name="engine" type="text" placeholder="Enter URL with %s in place of query"/>
				</label>
				<label>URL <span class="count">2</span>
					<input name="engine" type="text" placeholder="Enter URL with %s in place of query"/>
				</label>
				<button id="add" type="button">Add search engine</button>
			</div>
			<div id="query">
				<input name="q" id="query-input" type="text"/>
				<button type="submit">Search</button>
			</div>
		</form>
		<div id="results"></div>
	</body>

	<script>
		const resultsNode = document.getElementById('results');
		const queryNode = document.getElementById('query-input');
		const searchEnginesNode = document.getElementById('search-engines');
		const urlNodes = document.querySelectorAll('input[name="engine"]');
		const addButtonNode = document.getElementById('add');
		
		const params = (new URL(document.location)).searchParams;
		const query = params.get('q');
		const engines = params.getAll('engine');

		queryNode.value = query;

		addButtonNode.addEventListener('click', e => {
			createSearchEngineInput();
		});

		for (let i=0; i<engines.length; i++) {
			const engineURL = engines[i];
			if (engineURL) {
				const urlNode = urlNodes[i] || createSearchEngineInput();
				urlNode.value = engineURL;

				if (query) {
					const iframe = document.createElement('iframe');
					iframe.src = engineURL.replace('%s', query);
					resultsNode.appendChild(iframe);
				}
			}
		}

		function createSearchEngineInput() {
			const searchEngineNode = urlNodes[0].parentNode.cloneNode(true);
			const urlNode = searchEngineNode.querySelector('input');

			const count = searchEnginesNode.childElementCount;
			searchEngineNode.querySelector('.count').textContent = count;
			urlNode.value = '';

			searchEnginesNode.insertBefore(searchEngineNode, addButtonNode);
			return urlNode;
		}
	</script>
</html>
